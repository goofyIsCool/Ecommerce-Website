{% extends 'shop/base.html' %}
{% load static %}
{% block content %}

<div class="small-container cart-page">
	<div class="row">
		<div class="col-2">
			<a class="btn" href="{% url 'shop:products' %}">&#x2190; Kontynuuj zakupy</a>
		</div>
		<div class="col-2">
			<a onclick="checkout()" style="float: right" class="btn">Zapłać</a>
		</div>
	</div>
	<table>
		<tr>
			<th>Produkt:</th>
			<th>Ilość:</th>
			<th>W sumie:</th>
		</tr>
		{% if items %}
		{% for item in items %}
		<tr>
			<div class="">
				<td>
					<div class="cart-info">
						<a href="{{ item.product.get_absolute_url }}"><img src="{{ item.product.image1.url }}" ></a>
						<div>
							<p>{{item.product.title}}</p>
							<small>Cena: {{item.product.price}}PLN</small>
							<br/>
							<a href="">Usuń</a>
						</div>
					</div>
				</td>
				<td>
					<div class="number">
						<span class="minus">-</span>
						<input type="number" value="{{item.quantity}}"/>
						<span class="plus">+</span>
					</div>
				</td>
				<td>{{item.get_total}}PLN</td>
			</div>
		</tr>
		</table>
		{% endfor %}
		{% else %}
		</table>
		<center>
				<div class="container" style="margin-top: 50px;">
						<div class="info">
								<h2 class="card-title">
										Brak produktów
								</h2>
								<p class="card-text">Twój koszyk wciąż jest pusty.</p>
						</div>
				</div>
		</center>
		{% endif %}

	<div class="total-price">
		<table>
			<tr>
				<td>Razem</td>
				<td>{{order.get_cart_total}} PLN</td>
			</tr>
			<tr>
				<td>Podatek</td>
				<td>{{order.get_cart_total_vat|floatformat:2}} PLN</td>
			</tr>
			<tr>
				<td>W sumie</td>
				<td>{{order.get_cart_total_brutto|floatformat:2}} PLN</td>
			</tr>
		</table>
	</div>
</div>

<script type="text/javascript">
	function checkout() {
		counterCartItems = '{{counterCartItems}}'
		console.log(counterCartItems)
		if (counterCartItems == '0'){
			alert("Twój koszyk jest pusty.");
		}
		else{
			user = '{{ user.is_authenticated }}'
			if (user == 'True'){
				window.location.href = "{% url 'shop:checkout' %}"
			}
			else{
				window.location.href = "{% url 'shop:guest' %}"
			}
		}
	}

	$('.update-cart2').click(function(){
		var productId = $(this).attr("data-productId");
		var action = $(this).attr("data-action");
		var pack = parseInt(this.dataset.pack);

		inputVal = 0
		console.log(productId)
		console.log(action)
		var url = '/add_to_cart/'
		$.ajax(
		{
			type:'GET',
			url: url,
			data:{
				 productId: productId,
				 action: action,
				 inputVal: inputVal,
			},
			success: function( data )
			{
				cartItems.innerHTML = data
				alert("Produkt został usunięty z twojego koszyka");
				$('#product'+productId).remove();
			}
		})
	});
</script>
{% endblock content %}
